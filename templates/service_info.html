{% extends 'init.html' %}
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>

    <title>{{ var.Site_name }}</title>
    {% block head_js %}
        <style>
            td {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .order {
                height: 60px;
                line-height: 60px;
                text-align: center;
            }

            .order .line {
                display: inline-block;
                width: 150px;
                border-top: 1px solid #ccc;
            }

            .order .txt {
                color: #686868;
                vertical-align: middle;
            }

        </style>

    {% endblock %}

</head>
<body>


{% block page %}



    <div class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="header">

                            <button type="button" id="post_data" class="btn btn-primary" style="margin-bottom: 15px;">信息更新</button>
                        </div>
                        <div class="toolbar">
                            <!--        Here you can write extra buttons/actions for the toolbar              -->
                        </div>

                        <table id="bootstrap-table" data-show-export="true"
               class="table" style="table-layout: fixed;">
                            <thead>
                                    <th data-field="name" data-sortable="true">vpn账号</th>
                                    <th data-field="sn_num" data-sortable="true">sn号码</th>
                                    <th data-field="ssl" data-sortable="true">sslip</th>
                                    <th data-field="ppp" data-sortable="true">xl2ip</th>
                                    <th data-field="remark" data-sortable="true">备注</th>

                            <th data-field="actions" class="td-actions text-right" data-events="operateEvents"
                                data-formatter="operateFormatter">操作
                            </th>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div><!--  end card  -->
                </div> <!-- end col-md-12 -->
            </div> <!-- end row -->

        </div>
    </div>




{% endblock %}
</body>

{% block end_js %}
    <!--   Core JS Files and PerfectScrollbar library inside jquery.ui   -->
    <script src="/static/js/jquery.min.js" type="text/javascript"></script>
    <script src="/static/js/jquery-ui.min.js" type="text/javascript"></script>
    <script src="/static/js/bootstrap.min.js" type="text/javascript"></script>


    <!--  Forms Validations Plugin -->
    <script src="/static/js/jquery.validate.min.js"></script>

    <!--  Plugin for Date Time Picker and Full Calendar Plugin-->
    <script src="/static/js/moment.min.js"></script>

    <!--  Date Time Picker Plugin is included in this js file -->
    <script src="/static/js/bootstrap-datetimepicker.js"></script>

    <!--  Select Picker Plugin -->
    <script src="/static/js/bootstrap-selectpicker.js"></script>

    <!--  Checkbox, Radio, Switch and Tags Input Plugins -->
    <script src="/static/js/bootstrap-checkbox-radio-switch-tags.js"></script>
    <!--  Notifications Plugin    -->
    <script src="/static/js/bootstrap-notify.js"></script>

    <!-- Sweet Alert 2 plugin -->
    <script src="/static/js/sweetalert2.js"></script>

    <!-- Vector Map plugin -->
    <script src="/static/js/jquery-jvectormap.js"></script>

    <!-- Wizard Plugin    -->
    <script src="/static/js/jquery.bootstrap.wizard.min.js"></script>

    <!--  Plugin for DataTables.net  -->
    <script src="/static/js/jquery.datatables.js"></script>

    <!--  Full Calendar Plugin    -->
    <script src="/static/js/fullcalendar.min.js"></script>

    <!-- Light Bootstrap Dashboard Core javascript and methods -->
    <script src="/static/js/light-bootstrap-dashboard.js"></script>

    <!--   Sharrre Library    -->
    <script src="/static/js/jquery.sharrre.js"></script>




    <script type="text/javascript">

        var $table = $('#bootstrap-table');

        function operateFormatter(value, row, index) {
            return [
                /**
                '<a rel="tooltip" title="View" class="btn btn-simple btn-info btn-icon table-action view" href="javascript:void(0)">',
                '<i class="fa fa-image"></i>',
                '</a>',**/
                '<a rel="tooltip" title="Edit" class="btn btn-simple btn-warning btn-icon table-action edit" href="javascript:void(0)">',
                '<i class="fa fa-edit"></i>',
                '</a>',
                '<a rel="tooltip" title="Remove" class="btn btn-simple btn-danger btn-icon table-action remove" href="javascript:void(0)">',
                '<i class="fa fa-remove"></i>',
                '</a>'
            ].join('');
        }

        $().ready(function () {
            window.operateEvents = {
                /**
                'click .view': function (e, value, row, index) {
                    info = JSON.stringify(row);

                    swal({
                        html:  '<div class="form-group">\n' +
                                '    <label class="col-sm-2 control-label">备注</label>\n' +
                                '    <div class="col-sm-10">\n' +
                                '       <p> '+ row.name + '</p>'+
                                '    </div>\n' +
                                '  </div>' +
                                '</br>',
                        showConfirmButton: false
                    });
                },**/
                'click .edit': function (e, value, row, index) {

                    swal({html:
                            '<div class="card">\n' +
                            '                            <div class="header">\n' +
                            '                                <h4 class="title" style="text-align:center">信息编辑</h4>\n' +
                            '                            </div>\n' +
                            '                            <div class="content">\n' +
                            '\n' +

                            '                                    <div class="row">\n' +
                            '                                        <div class="col-md-8">\n' +
                            '                                            <div class="form-group">\n' +
                            '                                                <label>VPN账号</label>\n' +
                            '                                                <input type="text" class="form-control" id="name" value="'+row['name']+ '">\n' +
                            '                                            </div>\n' +
                            '                                        </div>\n' +
                            '\n' +
                            '                                    </div>\n' +

                            '                                    <div class="row">\n' +
                            '                                        <div class="col-md-8">\n' +
                            '                                            <div class="form-group">\n' +
                            '                                                <label>SN号码</label>\n' +
                            '                                                <input type="text" class="form-control" id="sn_num" value="'+row['sn_num']+ '">\n' +
                            '                                            </div>\n' +
                            '                                        </div>\n' +
                            '\n' +
                            '                                    </div>\n' +

                             '                                    <div class="row">\n' +
                            '                                        <div class="col-md-8">\n' +
                            '                                            <div class="form-group">\n' +
                            '                                                <label>SSLIP</label>\n' +
                            '                                                <input type="text" class="form-control" id="ssl" value="'+row['ssl']+ '">\n' +
                            '                                            </div>\n' +
                            '                                        </div>\n' +
                            '\n' +
                            '                                    </div>\n' +

                             '                                    <div class="row">\n' +
                            '                                        <div class="col-md-8">\n' +
                            '                                            <div class="form-group">\n' +
                            '                                                <label>XL2IP</label>\n' +
                            '                                                <input type="text" class="form-control" id="ppp" value="'+row['ppp']+ '">\n' +
                            '                                            </div>\n' +
                            '                                        </div>\n' +
                            '\n' +
                            '                                    </div>\n' +

                                 '                                    <div class="row">\n' +
                            '                                        <div class="col-md-8">\n' +
                            '                                            <div class="form-group">\n' +
                            '                                                <label>备注</label>\n' +
                            '                                                <input type="text" class="form-control" id="remark" value="'+row['remark']+ '">\n' +
                            '                                            </div>\n' +
                            '                                        </div>\n' +
                            '\n' +
                            '                                    </div>\n' +

                            '                                    <div class="clearfix"></div>\n' +
                            '                            </div>\n' +
                            '                        </div>',
                         showCancelButton: true,
                        },
                        function () {
                            $.ajax({
                                    url: "{% url 'service_info' %}",
                                    type: "put",
                                    dataType: 'text',
                                    data: {

                                name: document.getElementById('name').value,
                                        sn_num: document.getElementById('sn_num').value,
                                        ssl: document.getElementById('ssl').value,
                                        ppp: document.getElementById('ppp').value,
                                        remark: document.getElementById('remark').value,

                                    },

                                    success: function (data) {

                                        if ( data > 0 ) {

                                            var notify = $.notify({
                                                    icon: 'fa fa-server',
                                                    message: row['name'] + "： 备注正在写入数据库。。。 ",
                                                },
                                                {
                                                    type: 'info'
                                                }
                                            );

                                            setTimeout(function () {
                                                notify.update('type', 'success')
                                                notify.update('message', "更新成功："+data+" (个)" );
                                                $table.bootstrapTable('refresh');
                                            }, 3000);


                                        }
                                    },

                                }
                            );


                        },
                    );


                },
                'click .remove': function (e, value, row, index) {
                    $table.bootstrapTable('remove', {
                        field: 'name',
                        values: [row.name]
                    });
                    $.ajax({
                        url: "/api/v1/Service_info/",
                        type: 'delete',
                        dataType: 'text',
                        data: {
                            id: row.name
                        },
                        success: function () {

                            $.notify({
                            icon: 'pe-7s-trash',
                            message: "主机 "+ row['name'] +" 已经被删除！！！",
                        },
                        {
                            type: 'danger'
                        }
                    );
                        },
                    })
                }
            };

            $table.bootstrapTable({
                toolbar: ".toolbar",
                url: '/api/v1/Service_info/',
                method: 'get',
                queryParams:{"type":"ListData"},
                clickToSelect: true,
                showRefresh: true,
                search: true,
                showToggle: false,
                showColumns: true,
                pagination: true,
                searchAlign: 'left',
                pageSize: 8,
                pageList: [8, 25, 50, 'all'],

                formatShowingRows: function (pageFrom, pageTo, totalRows) {
                    //do nothing here, we don't want to show the text "showing x of y from..."
                },
                formatRecordsPerPage: function (pageNumber) {
                    return pageNumber + " rows visible";
                },
                icons: {
                    refresh: 'fa fa-refresh',
                    columns: 'fa fa-columns',
                    detailOpen: 'fa fa-plus-circle',
                    detailClose: 'fa fa-minus-circle'
                }
            });

            //activate the tooltips after the data table is initialized
            $('[rel="tooltip"]').tooltip();

            $(window).resize(function () {
                $table.bootstrapTable('resetView');
            });
        });

    </script>


<script src="/static/js/bootstrap-table.min.js"></script>
    <script src="/static/js/tableExport.min.js"></script>

<script src="/static/js/bte.min.js">

</script>
    <script type="text/javascript">
    $("#post_data").click(function() {
            $.ajax({
                        url: "/api/v1/Service_info/",
                        type: 'delete',
                        dataType: 'text',
                        data: {
                            id: 'winc00034',
                            'csrfmiddlewaretoken':$('[name="csrfmiddlewaretoken"]').val()
                        },
                error:function (d) {
                    console.log(d);
                }
                    })

                })
</script>
{% endblock %}

</html>
